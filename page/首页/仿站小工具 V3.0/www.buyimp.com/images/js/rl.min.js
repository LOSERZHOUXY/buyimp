"use strict";$.fn.extend({showLoading:function showLoading(){this.addClass("position-relative").append('\n            <div class=\'s-loading-cover\'>\n                <div class=\'s-loading\'>\n                    <div class="loading-bar"></div>\n                    <div class="loading-bar"></div>\n                    <div class="loading-bar"></div>\n                    <div class="loading-bar"></div>\n                </div>\n            </div>');this.find("div.s-loading-cover").fadeIn(500);return this},hideLoading:function hideLoading(){return this.removeClass("position-relative").find("div.s-loading-cover").fadeOut(500,function(){$(this).remove()})},serializeIgnore:function serializeIgnore(){var defaultValues=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.length>0&&this.prop("tagName")!=="FORM"){return""}var querys={};this.find("[name]").each(function(){var element=$(this);var name=element.attr("name");var value=element.val();if(typeof defaultValues[name]!=="undefined"&&defaultValues[name]===value){return}querys[name]=value});var string="";for(var name in querys){string+="&"+name+"="+querys[name]}return string!==""?string.substring(1):string}});jQuery(document).ready(function($){var _this=this;$("#mobile-search-icon").click(function(){$("div.header-notifications + div.search-bar-wrapper").slideToggle("fast")});if(swal){swal.setDefaults({confirmButtonText:rl_js_params.trans.confirm,cancelButtonText:rl_js_params.trans.cancel,cancelButtonColor:"#d04949",confirmButtonColor:"#f90"})}$("form.with-disable").submit(function(){$(this).find("[type=submit]").prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>")});if(document.querySelector("body.page-id-11217")){var sendTimeout=void 0;$("#account-register-type").change(function(){var val=$(this).val();if(val==="21"){$("#register-type-email").show();$("#register-type-phone").hide()}else{$("#register-type-email").hide();$("#register-type-phone").show()}});$("#rl-social-register-form").submit(function(e){var form=$(this);if(!registerFormValidator||!registerFormValidator.checkForm()){return false}if(!$("#agree_to_user_policy").is(":checked")){swal({title:rl_js_params.trans.agree_site_policy,type:"error",customClass:"error"});return false}form.find("[type=submit]").prop("disabled",true);return true});$("#send-verification-code").click(function(){var phone=$("#register-phone").val();if(phone===""){swal({title:"请输入您的手机号码",type:"error",customClass:"error"});return}var button=$(this);var timer=45;button.prop("disabled",true).text(rl_js_params.trans.sent_code+" ("+timer+")");sendTimeout=setInterval(function(){if(timer<=0){clearInterval(sendTimeout);button.prop("disabled",false).text(rl_js_params.trans.resend_code);return}timer--;button.text(rl_js_params.trans.sent_code+" ("+timer+")")},1e3);var url=rl_js_params.api_url+"/sms/registration";postJson({cell:phone},url).then(function(res){if(res.status!=="ok"){swal({title:res.errorMessage,type:"error",customClass:"error"});clearInterval(sendTimeout);button.prop("disabled",false).text(rl_js_params.trans.resend_code)}},function(){swal({title:rl_js_params.trans.internal_error,type:"error",customClass:"error"})})})}if(document.querySelector("body.page-id-60")){$(document).on("click","#force-relogin",function(){var url=rl_js_params.api_url+"/users/logoff/force";var button=$(this);var orgText=button.text();button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");deleteJson({},url,true).then(function(res){if(res.status==="ok"){location.href=rl_js_params.base_url+"/login?_response=session_error"}else{swal({title:res.errorMessage,type:"error",customClass:"error"});return;button.prop("disabled",false).text(orgText)}},function(){swal({title:rl_js_params.trans.internal_error,type:"error",customClass:"error"});button.prop("disabled",false).text(orgText)})});$("#rl-checkout-page div.custom-address input, #rl-checkout-page div.custom-address select, #rl-checkout-page div.custom-address textarea").blur(function(){if(checkoutValidator&&checkoutValidator.checkForm()){$("#address-details-empty").hide();var addressDetail=$("#address-details").show();$("#rl-checkout-page div.custom-address input, #rl-checkout-page div.custom-address textarea").each(function(){var element=$(this);addressDetail.find("span[target="+element.attr("name")+"]").text(element.val())});$("#rl-checkout-page div.custom-address select").each(function(){var element=$(this);addressDetail.find("span[target="+element.attr("name")+"]").text(element.prev().text())})}});$("#refresh-checkout-addresses").click(function(){var button=$(this);var orgText=button.text();button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");var url=rl_js_params.api_url+"/template/customer/address";$.get(url).then(function(res){$("#rl-checkout-page ul.customer-addrsses").html(res);button.prop("disabled",false).text(orgText)},function(error){swal({title:rl_js_params.trans.internal_error,type:"error",customClass:"error",confirmButtonText:rl_js_params.trans.return});button.prop("disabled",false).text(orgText)})});$("#continue-checkout").click(function(){var processingHtml=$("#checkout-processing h5.status");processingHtml.text("审核信息中");var isPolicyAgreed=$("#agree-policy").is(":checked");var nounce=$("#checkoutn").val();if(!isPolicyAgreed){swal({title:rl_js_params.trans.agree_to_shipping_policy,type:"error",customClass:"error"});return}$("body").addClass("locked");$("#checkout-processing").fadeIn();$("#checkout-errors").remove();var url=rl_js_params.api_url+"/order/"+$("#order-id").val()+"/checkout";var notes={};$("#rl-checkout-page tr.note-row input").each(function(){var input=$(this);notes[input.data("vendorId")]=input.val()});var data={"is-policy-agreed":isPolicyAgreed?1:0,checkoutn:nounce,notes:notes,method:$("[name=payment_method]:checked").val()};postJson(data,url).then(function(orderRes){if(orderRes.status==="ok"){$("#checkout-processing h5.status").text("跳转中...");$(orderRes.result.postForm).appendTo("body").submit()}else{$("#checkout-processing").fadeOut(500,function(){$("<div id=\"checkout-errors\" class='message-field error'>"+orderRes.errorMessage+"</div>").insertBefore("#rl-checkout-page");$("body").removeClass("locked");$("html, body").animate({scrollTop:$("#checkout-errors").offset().top-80},500)})}},function(orderRejected){$("body").removeClass("locked");$("#checkout-processing").fadeOut(500,function(){commonErrorSwalHandler("生成订单出错, 请尝试刷新本页")})})});$("#submit-checkout").click(function(){var processingHtml=$("#checkout-processing h5.status");var form=$("#rl-checkout-page");processingHtml.text("审核信息中");var selectedAddress=form.find("input[name=selected-address]:checked").val();var isPolicyAgreed=$("#agree-policy").is(":checked");var nounce=$("#checkoutn").val();if(!isPolicyAgreed){swal({title:rl_js_params.trans.agree_to_shipping_policy,type:"error",customClass:"error"});return}if(selectedAddress==="custom"&&!form.valid()){swal({type:"warning",customClass:"warning",title:"请完整填写您的配货地址信息",confirmButtonText:rl_js_params.trans.return}).then(function(){$("html, body").animate({scrollTop:$("#rl-checkout-page div.custom-address").offset().top-50},600)});return}$("body").addClass("locked");$("#checkout-processing").fadeIn();$("#checkout-errors").remove();var verifyUrl=rl_js_params.api_url+"/payment/verify";var data={"is-policy-agreed":isPolicyAgreed?"1":"0",checkoutn:nounce};if(selectedAddress==="custom"){$("#rl-checkout-page div.custom-address input, #rl-checkout-page div.custom-address select, #rl-checkout-page div.custom-address textarea").each(function(){var element=$(this);data[element.attr("name")]=element.val();data["selected-address"]="custom"})}else{data["selected-address"]=$("#rl-checkout-page input[name=selected-address]:checked").val()}postJson(data,verifyUrl,true).then(function(res){if(res.status==="ok"&&res.result.success===1){var orderData={checkoutn:nounce,payment_method:$("#payment input[name=payment_method]:checked").val(),notes:{}};$("#rl-checkout-page tr.note-row input").each(function(){var input=$(this);orderData["notes"][input.data("vendorId")]=input.val()});processingHtml.text("生成订单中");var orderUrl=rl_js_params.api_url+"/payment/checkout";postJson(orderData,orderUrl).then(function(orderRes){if(orderRes.status==="ok"){$("#checkout-processing h5.status").text("跳转中...");$(orderRes.result.postForm).appendTo("body").submit()}else if(typeof orderRes.errorList!=="undefined"){location.href=orderRes.errorList}else{$("#checkout-processing").fadeOut(500,function(){$("<div id=\"checkout-errors\" class='message-field error'>"+orderRes.errorMessage+"</div>").insertBefore("#rl-checkout-page");$("body").removeClass("locked");$("html, body").animate({scrollTop:$("#checkout-errors").offset().top-80},500)})}},function(orderRejected){$("body").removeClass("locked");$("#checkout-processing").fadeOut(500,function(){commonErrorSwalHandler("生成订单出错, 请尝试刷新本页")})})}else{$("#checkout-processing").fadeOut(500,function(){if(typeof res.errorList!=="undefined"&&res.errorList.length>0){$("<div id=\"checkout-errors\" class='message-field error'>\n                                "+res.errorMessage+"\n                                "+res.errorList.map(function(error,index){return"<p>"+(index+1)+". "+error+"</p>"}).join("")+"\n                            </div>").insertBefore("#rl-checkout-page")}else{$("<div id=\"checkout-errors\" class='message-field error'>"+res.errorMessage+"</div>").insertBefore("#rl-checkout-page")}$("body").removeClass("locked");$("html, body").animate({scrollTop:$("#checkout-errors").offset().top-80},500)})}},function(rejected){$("body").removeClass("locked");$("#checkout-processing").fadeOut(500,function(){commonErrorSwalHandler()})})});$("#province-holder").change(function(){var element=$(this);var pid=element.val();if(pid!==""){element.prev().html("<i class='fa fa-circle-o-notch fa-spin'></i>");var cityHolder=$("#city-holder");cityHolder.prop("disabled",true);var pricingField=$("section.overview-fields>div.pricing");pricingField.showLoading();var url=rl_js_params.api_url+"/checkout/refresh-provinces";postJson({province:pid},url).then(function(res){if(res.status==="ok"){var options=res.result.cities.map(function(city,index){if(index===0){return"<option value="+city.cid+" selected>"+city.city+"</option>"}return"<option value="+city.cid+">"+city.city+"</option>"}).join("");cityHolder.prop("disabled",false).html("<option value=''>"+rl_js_params.trans.city+"</option>"+options);pricingField.hideLoading();pricingField.find("div.pricing-overview").replaceWith(res.result.pricingField)}else{swal({title:res.result,customClass:"error",type:"error"})}},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error"})})}});$(document).on("click","div.existing-address",function(){var element=$(this);var addressData=JSON.parse(element.find("input[type=hidden]").val());var customAddressField=$("div.custom-address");$(".existing-address.selected").removeClass("selected");element.addClass("selected");element.find("input[name=selected-address]").prop("checked",true);if(customAddressField.is(":visible")){customAddressField.slideUp(500)}var addressDetail=$("#address-details").show();$("#address-details-empty").hide();for(var attr in addressData){addressDetail.find("span[target="+attr+"]").text(addressData[attr])}var pricingField=$("section.overview-fields>div.pricing");pricingField.showLoading();var url=rl_js_params.api_url+"/template/checkout/pricing";$.post(url,{addressId:addressData.address_id}).then(function(res){pricingField.hideLoading();pricingField.find("div.pricing-overview").replaceWith(res)},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error"});pricingField.hideLoading()})});$("#address-toggle-down").click(function(){$(this).toggleClass("close");$("ul.customer-addrsses").slideToggle()});$("#use-custom-address").click(function(){var customAddressField=$("div.custom-address");if(!customAddressField.is(":visible")){$(".existing-address.selected").removeClass("selected");$("#custom-address-selector").prop("checked",true);customAddressField.slideDown(500,function(){if(checkoutValidator&&checkoutValidator.checkForm()){var province=void 0;$("#address-details-empty").hide();var addressDetail=$("#address-details").show();$("#rl-checkout-page div.custom-address input, #rl-checkout-page div.custom-address textarea").each(function(){var element=$(this);addressDetail.find("span[target="+element.attr("name")+"]").text(element.val())});$("#rl-checkout-page div.custom-address select").each(function(){var element=$(this);var attr=element.attr("name");addressDetail.find("span[target="+attr+"]").text(element.prev().text());if(attr==="province"){province=element.val()}});var pricingField=$("section.overview-fields>div.pricing");pricingField.showLoading();var url=rl_js_params.api_url+"/template/checkout/pricing";$.post(url,{province:province}).then(function(res){pricingField.hideLoading();pricingField.find("div.pricing-overview").replaceWith(res)},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error"});pricingField.hideLoading()})}else{$("#address-details").hide().find("span[name]").text("");$("#address-details-empty").show()}})}})}if(document.querySelector("body.page-id-59")){$("#recover-carts").click(recoverCartAction);$("button[role=remove-item]").click(function(){var button=$(this);var itemKey=button.data("item-key");var orgHtml=button.html();button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");var url=rl_js_params.api_url+"/customer/cart/"+itemKey;deleteJson({nounce:$("#_wpnonce").val(),notice:"1"},url).then(function(res){if(res.status==="ok"){location.reload()}else{button.prop("disabled",false).html(orgHtml);commonErrorSwalHandler(res.errorMessage)}},function(rejected){button.prop("disabled",false).html(orgHtml);commonErrorSwalHandler()})});if(rl_js_params.on_mobile==="1"){$("button[role=fav-item-mobile]").click(function(){var button=$(this);var productId=button.data("product-id");var orgHtml=button.html();button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");var url=rl_js_params.api_url+"/product/"+productId+"/favorite/toggle";putJson({},url).then(function(res){button.prop("disabled",false).html(orgHtml);if(res.status==="ok"){if(res.result.favorited==="1"){button.addClass("favorited")}else{button.removeClass("favorited")}}else{commonErrorSwalHandler("收藏操作出错, 请稍后再试")}},function(rejected){button.prop("disabled",false).html(orgHtml);commonErrorSwalHandler()})});$("input[role=cart-item-select]").click(function(){var element=$(this);var isSelected=element.is(":checked");var itemKey=element.data("item-key");var url=rl_js_params.api_url+"/mobile/customer/cart/"+itemKey;var totalholder=$("#estimated-total");var orgValue=totalholder.html();totalholder.html("<i class='fa fa-circle-o-notch fa-spin'></i>");putJson({is_selected:isSelected?"1":"0",nounce:$("#_wpnonce").val()},url).then(function(res){if(res.status==="ok"&&res.result.updated==="1"){totalholder.html(res.result.total);$("#selected-qty").text(res.result.qty)}else{totalholder.text(orgValue)}})});$("#woocommerce-cart-form button[role=qty-plus]").click(function(){var element=$(this);var productId=element.data("product-id");var qtyHolder=$("#product-qty-"+productId);var max=qtyHolder.data("max")||1;var currentValue=Number(qtyHolder.val());var newValue=currentValue+1;qtyHolder.val(newValue);$("#qty-text-"+productId).text(newValue);var itemKey=element.data("item-key");var url=rl_js_params.api_url+"/mobile/customer/cart/"+itemKey;var totalholder=$("#estimated-total");var orgValue=totalholder.html();totalholder.html("<i class='fa fa-circle-o-notch fa-spin'></i>");putJson({qty:newValue,nounce:$("#_wpnonce").val()},url).then(function(res){if(res.status==="ok"&&res.result.updated==="1"){$("#product-fee-"+productId).html(res.result.fee);totalholder.html(res.result.total);$("#selected-qty").text(res.result.qty)}else{totalholder.text(orgValue)}})});$("#woocommerce-cart-form button[role=qty-minus]").click(function(){var element=$(this);var productId=element.data("product-id");var qtyHolder=$("#product-qty-"+productId);var min=1;var currentValue=Number(qtyHolder.val());if(currentValue-1<0){commonErrorSwalHandler("商品数量不能少于0");return}var newValue=currentValue-1;qtyHolder.val(newValue);$("#qty-text-"+productId).text(newValue);if(newValue===0){return}var itemKey=element.data("item-key");var url=rl_js_params.api_url+"/mobile/customer/cart/"+itemKey;var totalholder=$("#estimated-total");var orgValue=totalholder.html();totalholder.html("<i class='fa fa-circle-o-notch fa-spin'></i>");putJson({qty:newValue,nounce:$("#_wpnonce").val()},url).then(function(res){if(res.status==="ok"&&res.result.updated==="1"){$("#product-fee-"+productId).html(res.result.fee);totalholder.html(res.result.total);$("#selected-qty").text(res.result.qty)}else{totalholder.text(orgValue)}},function(rejected){totalholder.text(orgValue)})})}$("#woocommerce-cart-form input[role=vendor-item-select]").change(function(){var vendorId=$(this).data("vendor-id");$("#woocommerce-cart-form input[name=update_cart]").prop("disabled",false);$("#woocommerce-cart-form input[belonged-vendor="+vendorId+"]").prop("checked",$(this).is(":checked"));if(rl_js_params.on_mobile==="1"){var url=rl_js_params.api_url+"/mobile/customer/cart/select/"+vendorId;var data={is_selected:$(this).is(":checked")?"1":"0",nounce:$("#_wpnonce").val()};var totalholder=$("#estimated-total");var orgValue=totalholder.html();totalholder.html("<i class='fa fa-circle-o-notch fa-spin'></i>");putJson(data,url).then(function(res){if(res.status==="ok"){totalholder.html(res.result.total);$("#selected-qty").text(res.result.qty)}else{totalholder.text(orgValue)}},function(rejected){totalholder.text(orgValue)})}});$("#woocommerce-cart-form input[role=bulk-item-select]").change(function(){var isChecked=$(this).is(":checked");$("#woocommerce-cart-form input[name=update_cart]").prop("disabled",false);$("#woocommerce-cart-form input[type=checkbox]").prop("checked",isChecked);if(rl_js_params.on_mobile==="1"){var url=rl_js_params.api_url+"/mobile/customer/cart/select";var totalholder=$("#estimated-total");var orgValue=totalholder.html();totalholder.html("<i class='fa fa-circle-o-notch fa-spin'></i>");putJson({nounce:$("#_wpnonce").val(),is_selected:isChecked?"1":"0"},url).then(function(res){if(res.status==="ok"&&res.result.updated==="1"){totalholder.html(res.result.total);$("#selected-qty").text(res.result.qty)}else{totalholder.html(orgValue)}},function(rejected){totalholder.html(orgValue)})}});$("a.register").click(function(e){e.preventDefault();setTimeout(function(){$(".onesocial-register-popup-link").trigger("click")},90)});$(document).on("click","#delete-bulk",function(){var itemKeys=$("#woocommerce-cart-form input[role=cart-item-select]:checked").map(function(){return $(this).data("item-key")}).get();if(itemKeys.length>0){var button=$(this);var orgText=button.text();button.prop("disabled",true).html(button.data("loading-text"));var url=rl_js_params.api_url+"/cart";var data={itemKey:itemKeys};deleteJson(data,url).then(function(res){if(res.status==="ok"){location.reload()}else{swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)}},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)})}else{swal({title:rl_js_params.trans.no_items_selected,customClass:"warning",type:"warning",confirmButtonText:rl_js_params.trans.return})}});$(document).on("click","#favoriate-bulk",function(){var productIds=$("#woocommerce-cart-form input[role=cart-item-select]:checked").map(function(){return $(this).data("product-id")}).get();if(productIds.length>0){var button=$(this);var orgText=button.text();button.prop("disabled",true).html(button.data("loading-text"));var url=rl_js_params.api_url+"/products/favorite";var data={productIds:productIds};putJson(data,url).then(function(res){if(res.status==="ok"){if(res.result.favorited===0){swal({title:"所选商品都已被收藏",customClass:"warning",type:"warning",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)}else{location.reload()}}else{swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)}},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)})}else{swal({title:rl_js_params.trans.no_items_selected,customClass:"warning",type:"warning",confirmButtonText:rl_js_params.trans.return})}});$(document).on("click","#checkout-button",function(e){var productIds=$("#woocommerce-cart-form input[role=cart-item-select]:checked").map(function(){return $(this).data("product-id")}).get();if(productIds.length>0){var button=$(this);button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");$("#woocommerce-cart-form").append('<input type="hidden" name="checkout-forward" value="1" />').submit()}else{e.preventDefault();swal({title:rl_js_params.trans.no_items_selected,customClass:"warning",type:"warning",confirmButtonText:rl_js_params.trans.return})}});$(document).on("click","#buy-later-bulk",function(){var itemKeys=$("#woocommerce-cart-form input[role=cart-item-select]:checked").map(function(){return $(this).data("item-key")}).get();if(itemKeys.length>0){var button=$(this);var orgText=button.text();button.prop("disabled",true).html(button.data("loading-text"));var url=rl_js_params.api_url+"/cart/save-later";var data={itemKey:itemKeys};postJson(data,url).then(function(res){if(res.status==="ok"){location.reload()}else{swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)}},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.text(orgText).prop("disabled",false)})}else{swal({title:rl_js_params.trans.no_items_selected,customClass:"warning",type:"warning",confirmButtonText:rl_js_params.trans.return})}});$(document).on("click","a[role=buyer-later]",function(){var productId=$(this).data("product-id")});$("button[role=buy-later]").click(function(){var cartKey=$(this).data("cart-key");var button=$(this);var orgText=button.text();button.prop("disabled",true).html("<i class='fa fa-spinner fa-spin '></i>");var url=rl_js_params.api_url+"/cart/save-later";postJson({itemKey:cartKey},url).then(function(res){if(res.status==="ok"){location.reload()}else{commonErrorSwalHandler();button.text(orgText).prop("disabled",false)}},function(rejected){commonErrorSwalHandler();button.text(orgText).prop("disabled",false)})});$(document).on("click","button[role=fav-item]",function(){var productId=$(this).data("product-id");var button=$(this);var orgText=button.text();button.prop("disabled",true).html(button.data("loading-text"));var url=rl_js_params.api_url+"/product/"+productId+"/favorite";putJson({},url,true).then(function(res){if(res.status==="ok"){button.html('<i class="fa fa-check"></i> 商品收藏成功');setTimeout(function(){button.replaceWith("<span>已收藏</span>")},2e3)}else{commonErrorSwalHandler();button.text(orgText).prop("disabled",false)}},function(rejected){commonErrorSwalHandler();button.text(orgText).prop("disabled",false)})})}if(document.querySelector("#post-61")){$("input[name=validation-type]").change(function(){var recoverType=$(this).val();var validationContainer=$("#validation-input-container");switch(recoverType){case"email":$("#skip-to").hide();var label=validationContainer.find("label");var labelText=label.attr("recover")!=="0"?rl_js_params.trans.your_username_email_cell:rl_js_params.trans.your_email;validationContainer.find("label").text(labelText);validationContainer.find("input").val("");break;case"cell":$("#skip-to").show();validationContainer.find("label").text(rl_js_params.trans.your_phone);validationContainer.find("input").val("");break}});$("#remove-addresses").click(function(){var selectContainer=$("#selected-address-field");var selectedFields=selectContainer.val();if(selectedFields!==""){swal({title:rl_js_params.trans.confirm_to_delete_address,type:"warning",customClass:"warning",showCancelButton:true,showLoaderOnConfirm:true,preConfirm:function preConfirm(){return new Promise(function(resolve,reject){var data={addressId:selectedFields};var url=rl_js_params.api_url+"/customer/addresses";deleteJson(data,url).then(function(res){if(res.status==="ok"){var ids=selectedFields.split(",");var selectors=ids.map(function(id){return"#existing-address-"+id}).join(",");$(selectors).remove();selectContainer.val("");resolve()}else{reject(rl_js_params.trans.internal_error)}},function(error){reject()})})}}).then(function(isConfirmed){if(isConfirmed&&isConfirmed.value){swal({title:rl_js_params.trans.address_deleted,type:"success",customClass:"success"});if($(".existing-addresses tbody>tr").length===0){$(".existing-addresses tbody").append("<tr class='empty'><td colspan=\"10\">"+rl_js_params.trans.no_saved_address+"</td></tr>")}}},function(rejected){commonErrorSwalHandler()})}else{swal({title:rl_js_params.trans.no_address_selected,customClass:"error",type:"error"})}});$("#province-holder").change(function(){var pid=$(this).val();if(pid!==""){$("#address-city-container .buddyboss-select-inner>span").html("<i class='fa fa-circle-o-notch fa-spin'></i>");var url=rl_js_params.api_url+"/address/city/"+pid;getJson({},url).then(function(res){if(res.status==="ok"){var options=res.result.map(function(city,index){if(index===0){return"<option value="+city.cid+" selected>"+city.city+"</option>"}return"<option value="+city.cid+">"+city.city+"</option>"}).join("");$("#city-holder").html("<option value=''>"+rl_js_params.trans.city+"</option>"+options)}})}});$(".existing-addresses td>input[type=checkbox]").change(function(){var input=$(this);var selectedField=$("#selected-address-field");var selected=selectedField.val()===""?[]:selectedField.val().split(",");if(input.is(":checked")){selected.push(input.data("address-id"));selectedField.val(selected.join(","))}else{selectedField.val(selected.filter(function(addressId){return addressId!=input.data("address-id")}).join(","))}});$("#select-existing-addresses").change(function(){if($(this).is(":checked")){var selected=[];$(".existing-addresses td>input[type=checkbox]").each(function(){var input=$(this);input.prop("checked",true);selected.push(input.data("address-id"))});$("#selected-address-field").val(selected.join(","))}else{$(".existing-addresses input[type=checkbox]").each(function(){var input=$(this);input.prop("checked",false)});$("#selected-address-field").val("")}});$("#reset-new-address").click(function(){$("#new-address-form")[0].reset();$("#new-address-form label.error").hide();$("#new-address-form input[aria-invalid=false]").removeAttr("aria-invalid");$("div.buddyboss-select-inner").each(function(){var element=$(this);element.find("span").text(element.find(".rl-select>option[selected=selected]").text())})});$("#address-sort").change(function(){var value=$(this).val();document.location=rl_js_params.base_url+"/my-account/edit-address"+(value==="id_desc"?"":"?sorting="+value)});$("#reset-editing-address").click(function(){$("#editing-address-form")[0].reset();$("#editing-address-form label.error").hide();$("#editing-address-form input[aria-invalid=false]").removeAttr("aria-invalid");$("div.buddyboss-select-inner").each(function(){var element=$(this);element.find("span").text(element.find(".rl-select>option[selected=selected]").text())})});$("button[role=delete-address]").click(function(){var button=$(this);var tr=button.parent().parent();swal({title:rl_js_params.trans.confirm_to_delete_address,type:"warning",showLoaderOnConfirm:true,showCancelButton:true,customClass:"warning",preConfirm:function preConfirm(){return new Promise(function(resolve,reject){var url=rl_js_params.api_url+"/customer/addresses/"+button.data("address-id");deleteJson({},url).then(function(res){if(res.status==="ok"){resolve()}else{reject(rl_js_params.trans.internal_error)}},function(error){reject(rl_js_params.trans.internal_error)})})}}).then(function(isConfirmed){if(isConfirmed&&isConfirmed.value){swal({title:rl_js_params.trans.address_deleted,type:"success",customClass:"success"});tr.remove();if($(".existing-addresses tbody>tr").length===0){$(".existing-addresses tbody").append("<tr class='empty'><td colspan=\"10\">暂无任何已保存地址</td></tr>")}}},function(rejected){swal({title:rejected,type:"error",customClass:"error"})})})}$("img").error(function(){$(this).attr("src","https://static.buyimp.com/rl/image_no_found_300.png")});$(document).mouseup(function(e){var container=$("#bottom-selected-language + ul");if(!container.is(e.target)&&container.has(e.target).length===0){if($("#bottom-selected-language").is(e.target)){container.animate({height:"toggle"},300)}else{container.slideUp("fast")}}});$("#bottom-selected-language").click(function(){$("#bottom-selected-language + ul").slideDown("fast")});if(document.querySelector("div.feedback-sumit-form")){$("div.controllable-rating-stars .star").mouseenter(function(){var star=$(this);var hoveredStar=Number(star.data("star-num"));var productNum=star.data("product-feedback");$("div.feedback-star-"+productNum+" .star.hovered").removeClass("hovered");for(var i=1;i<=hoveredStar;i++){$("div.feedback-star-"+productNum+" .star-"+i).addClass("hovered")}});$("div.controllable-rating-stars .star").mouseleave(function(){var star=$(this);var productNum=star.data("product-feedback");var currentStar=$("#product-rating-"+productNum).val();if(isNaN(currentStar)){$("div.feedback-star-"+productNum+" .star.hovered").removeClass("hovered")}else{for(var i=1;i<=currentStar;i++){$("div.feedback-star-"+productNum+" .star-"+i).addClass("hovered")}}});$("div.controllable-rating-stars .star").click(function(){var star=$(this);var hoveredStar=Number(star.data("star-num"));var productNum=star.data("product-feedback");$("#product-rating-"+productNum).val(hoveredStar);if(rl_js_params.on_mobile==="1"){$("div.feedback-star-"+productNum+" .star.hovered").removeClass("hovered");for(var i=1;i<=hoveredStar;i++){$("div.feedback-star-"+productNum+" .star-"+i).addClass("hovered")}}});$(".new-image>a").click(function(){var feedbackNum=$("div.product-feedback-"+$(this).data("feedback-number")).length;if(feedbackNum>=5){swal(rl_settings.trans.max_gallery_image_exceeds,"","error")}else{$(this).prev().click()}});$("div.rl-medias.multiple .new-image>input[type=file]").change(function(e){var a=$(this).next();var fbNumber=a.data("feedback-number");var uploadArgs={file:e.target.files[0],imageId:"",action:"rl_ajax_image_upload",prefix:"feedback/",parent:$("mark.order-number").html()};handleImageUpload.call(this,uploadArgs,function(res){var imageKey=res.image_key;var num=$("div.product-feedback-"+fbNumber+" .existing-image").length;var imageLink=rl_js_params.on_test==="1"?"http://img.temp.buyimp.com/"+imageKey+"-usual?"+Math.floor(Math.random()*300+1):"https://img.buyimp.com/"+imageKey+"-usual?"+Math.floor(Math.random()*300+1)
;var imageContainer=$('\n                    <div class="feedback-image-'+res.image_id+' existing-image">\n                        <input type="file" data-image-id=\''+res.image_id+"'/>\n                        <div class='cover'></div>\n                        <div class='actions'>\n                            <i class='fa fa-file-image-o' data-target=\"div.feedback-image-"+res.image_id+">input[type=file]\" title='"+rl_js_params.trans.replace_image+"'></i>\n                            <i class='fa fa-trash-o' data-image-id='"+res.image_id+"' data-feedback-number='"+fbNumber+"' title='"+rl_js_params.trans.remove_picture+"' ></i>\n                        </div>\n                        <img src=\""+imageLink+'" width="85"/>\n                    </div>\n                ');var newImage=$("div.product-feedback-"+fbNumber+" .new-image");newImage.before(imageContainer);if(num+1>=6){newImage.addClass("hidden")}var image_id_containers=$("#feedback-image_field-"+fbNumber);var feedback_ids=image_id_containers.val()===""?[]:image_id_containers.val().split(",");feedback_ids.push(res.image_id);image_id_containers.val(feedback_ids.join(","));swal(res.message,"","success")})});$(document).on("change","div.rl-medias div.existing-image>input[type=file]",function(e){var imageId=$(this).data("image-id");var uploadArgs={imageId:imageId,file:e.target.files[0],action:"rl_ajax_image_replace",prefix:"feedback/"};handleImageUpload.call(this,uploadArgs,function(res){var imageKey=res.image_key;var imageLink=rl_js_params.on_test==="1"?"http://img.temp.buyimp.com/"+imageKey+"-usual?"+Math.floor(Math.random()*300+1):"https://img.buyimp.com/"+imageKey+"-featuredproduct?"+Math.floor(Math.random()*300+1);$("div.feedback-image-"+imageId+">img").attr("src",imageLink);swal(res.message,"","success")})});$(document).on("click","div.rl-medias .existing-image>.actions> .fa-trash-o",function(){var element=$(this);var imageId=element.data("image-id");var feedbackNum=element.data("feedback-number");confirmToDeleteImage(function(){$("div.feedback-image-"+imageId).remove();var addNewButton=$("product-feedback-"+feedbackNum+" div.new-image");if(addNewButton.hasClass("hidden")){addNewButton.removeClass("hidden")}var _product_image_gallery=$("#feedback-image_field-"+feedbackNum);var imagesIds=_product_image_gallery.val().split(",").filter(function(id){return id!=imageId}).join(",");_product_image_gallery.val(imagesIds)})});$(document).on("click","div.rl-medias .existing-image>.actions>.fa-file-image-o",clickTargetElement)}$("div.rl-image-uploader>.image-container>.actions>.fa-file-image-o").click(clickTargetElement);$("div.personal-icon>.image-container>.actions>.fa-trash").click(rlDeleteActionHandler("personal-icon","#personal_icon_id"));$("#personal_icon_uploader").change(rlUploaderActionHandler("personal-icon","#personal_icon_id","user","iconusual"));$(".feedback-form").submit(function(){var button=$("buttton.rl-btn[type=submit]");button.prop("disabled",true);button.html(button.attr("data-loading-text"))});$(".rl-menu-categories .rl-category").mouseenter(function(){$(".rl.hovered .rl-menu-categories .rl-category.hovered").removeClass("hovered");var item=$(this);var productContainer=item.find(".products");item.addClass("hovered");if(productContainer.hasClass("not-loaded")){productContainer.removeClass("not-loaded");var termId=item.attr("term-id");var url=rl_js_params.api_url+"/category/"+termId+"/products";getJson({},url).then(handle_rl_nav_category_data(productContainer))}});$(".search-bar input").focus(function(){$(".search-bar .input-group").addClass("focused")});$(".search-bar input").blur(function(){$(".search-bar .input-group").removeClass("focused")});$(".bm_widget_product_categories").mouseenter(function(){var category=$(this);var productContainer=category.find(".rl-category:first-of-type .products");if(productContainer.hasClass("not-loaded")){productContainer.removeClass("not-loaded");var termId=category.find(".rl-category:first-of-type").attr("term-id");var url=rl_js_params.api_url+"/category/"+termId+"/products";getJson({},url).then(handle_rl_nav_category_data(productContainer))}});$(".search-type>li").click(function(){$(".search-type>li.active").removeClass("active");var button=$(this);button.addClass("active");var sType=$(this).attr("stype");var placeholder="";switch(sType){case"product":placeholder=rl_js_params.trans.product_placeholder;break;case"store":placeholder=rl_js_params.trans.store_placeholder;break}$(".search-bar .placeholder").text(placeholder)});$("div.search-bar input").keypress(function(e){if(e.which==13){var keywords=$(this).val();var currentType=$(".search-type>li.active").attr("stype");var link=void 0;switch(currentType){case"product":if(keywords===""){link="shop/"}else{link=rl_js_params.base_url+("?s="+keywords)}break;case"store":if(keywords===""){link="stores/"}else{link=rl_js_params.base_url+("stores/?bm_index_search="+keywords)}break}window.location.href=link}});$(".round-btn a, .reg-btn>a").click(function(){var currentType=$(".search-type>li.active").attr("stype");var keywords=$(".search-bar input").val();var link=void 0;switch(currentType){case"product":if(keywords===""){link="shop/"}else{link=rl_js_params.base_url+("?s="+keywords)}break;case"store":if(keywords===""){link="stores/"}else{link=rl_js_params.base_url+("stores/?bm_index_search="+keywords)}break}window.location.href=link});if(document.querySelector("div.search-result-products")){var conditions={sorting:"default",country:"all",brand:"all",cg:"all",min:"",max:"",ns:"",ptag:"all"};$("#keyword-holder-nd").keypress(function(e){if(e.which==13){var button=$("#keyword-search-nd");button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");location.href=rl_js_params.base_url+"?"+$("#filter-form").serializeIgnore(conditions)}});$("#keyword-search-nd").click(function(e){var button=$(this);button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");location.href=rl_js_params.base_url+"?"+$("#filter-form").serializeIgnore(conditions)});$("#keyword-holder").keypress(function(e){if(e.which==13){var button=$("#keyword-search");button.prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");location.href=rl_js_params.base_url+"?"+$("#filter-form").serializeIgnore(conditions)}});$("#keyword-search, #submit-price-filter").click(function(){$(this).prop("disabled",true).html("<i class='fa fa-circle-o-notch fa-spin'></i>");location.href=rl_js_params.base_url+"?"+$("#filter-form").serializeIgnore(conditions)});$("#keyword-sorting, #brand-search, #country-search, #category-search, #tag-search").change(function(){location.href=rl_js_params.base_url+"?"+$("#filter-form").serializeIgnore(conditions)})}if(document.querySelector("#storecb-request-form")){$("input[role=storecb-products]").click(function(){var ele=$(this);var input=$("#selected-items");var item=ele.val();var items=input.val()===""?[]:input.val().split(",");if(ele.is(":checked")){items.push(item);input.val(items.join(","))}else{var newItems=items.filter(function(i){return i!=item});input.val(newItems.join(","))}})}if(document.querySelector("body.bm-shop-page")){var stayedTime=0;setInterval(function(){stayedTime++},1e3);$(window).unload(function(){var data={action:"797a18ff349404c33",vendor_id:$("#shop-vendor-id").val(),stayed:stayedTime};$.ajax({url:ajaxurl,async:false,data:data,type:"GET",dataType:"JSON"})})}if(document.querySelector("body.single-product")){var _stayedTime=0;setInterval(function(){_stayedTime++},1e3);$(window).unload(function(){var data={action:"adbb821f71d5300f6",product_id:$("a.bm-product-to-favorites").data("id"),stayed:_stayedTime};$.ajax({url:ajaxurl,async:false,data:data,type:"GET",dataType:"JSON"})});if(document.querySelector("a.level-share-button.has-level")){$(window).unload(function(){var data={action:"d41d8cd98f00b204e",product_id:$("a.bm-product-to-favorites").data("id"),ref:$("a.level-share-button").data("ref-id")};$.ajax({url:ajaxurl,async:false,data:data,type:"GET",dataType:"JSON"})})}$("button.translate-btn").click(function(){var button=$(_this);var container=$("div.bm-product-description");var orginal=container.find("div.orginal");var translated=container.find("div.translated");var cover=$("div.bm-product-description>div.rl-loading-view");if(translated.html()==""){var orgText=button.text();button.prop("disabled",true).html(button.data("loading-text"));var orgHtml=orginal.html();var translatingContent=orgHtml.split(/\r?\n/).filter(function(html){return html.trim()!=""});orginal.hide();cover.fadeIn();var data={src:translatingContent};var url=rl_js_params.api_url+"/translate";postJson(data,url).then(function(res){if(res.status==="ok"){var rows=res.result.src.map(function(src,index){return"\n                                <div class='translated-row'>\n                                    <p class='source-content'>"+src+"</p>\n                                    <p class='translate-content'>"+res.result.dst[index]+"</p>\n                                </div>\n                            "}).join("");button.hide();$("button.recover-btn").show();translated.html(rows)}button.prop("disabled",false).text(orgText);cover.hide()},function(error){cover.hide();button.prop("disabled",false).text(orgText)})}else{orginal.hide();button.hide();translated.show();cover.hide();$("button.recover-btn").show()}});$("button.recover-btn").click(function(){$("div.bm-product-description>.translated").hide();$("div.bm-product-description>.orginal").show();$(this).hide();$("button.translate-btn").show()});$("#rating-below-owner").click(function(){$("#tab-title-reviews>a").click();$("html, body").animate({scrollTop:$("#tab-title-reviews").offset().top},500)});var onMobile=rl_js_params.on_mobile==="1";$("div.level-field-overlay").on("touchstart, touchmove",function(e){e.preventDefault()});if(onMobile){var handleShareButtonAction=function handleShareButtonAction(command){return function(){var config={title:document.title,desc:shareField.val(),link:shareLink,icon:"https://static.buyimp.com/rl/header-logo-56.png"};nativeShare.setShareData(config);try{nativeShare.call(command)}catch(err){setTimeout(function(){alert(rl_js_params.trans.browser_unable_to_share)},1e3)}}};var nativeShare=new NativeShare;var shareField=$("#share-field-mobile");var shareLink=shareField.attr("share-link");new QRCode(document.getElementById("share-qrcode"),{text:shareLink,width:300,height:300});$("button.share-to-wechat, button.share-to-wechatgroup").click(function(){$("div.qrcode").animate({width:"toggle"},300,function(){$("div.qrcode>.content").fadeIn("quick")})});$("button.share-to-weibo").click(handleShareButtonAction("weibo"));$("button.share-to-qzone").click(handleShareButtonAction("qZone"));$("button.share-to-qq").click(handleShareButtonAction("qqFriend"));$("button.copy-button").click(function(){Clipboard.copy($("#share-field-mobile").val());alert(rl_js_params.trans.share_copied)});$("#level-share-field-mobile a.close").click(function(){$("html, body").removeClass("locked");$("div.level-field-overlay").hide();$(".level-share-field-mobile").animate({height:"toggle"})});$("#level-share-field-mobile .qrcode .return").click(function(){$("div.qrcode>.content").hide();$("div.qrcode").animate({width:"toggle"},500)})}else{$("#js-share-social-text").change(function(e){_bd_share_config.bdDesc=e.target.value})}$("div.level-field-overlay").click(function(e){$("html, body").removeClass("locked");if(onMobile){$("div.qrcode").hide();$(".level-share-field-mobile").animate({height:"toggle"})}else{$(".level-share-field").fadeOut("fast")}$(this).hide()});$("a.level-share-button").click(function(){$("html, body").addClass("locked");$(".level-field-overlay").show();if(onMobile){$(".level-share-field-mobile").animate({height:"toggle"})}else{$(".level-share-field").fadeIn("fast")}});$("div.level-share-field .close").click(function(){$("html, body").removeClass("locked");$(".level-share-field").fadeOut("fast");$(".level-field-overlay").hide()});$("[name=share-type]").change(function(){if($(this).val()==="social"){$(".field-social").show();$(".field-link").hide()}else{$(".field-link").show();$(".field-social").hide()}});$(".field-link>.copy-button").click(function(){Clipboard.copy($(".field-link>input").val());alert(rl_js_params.trans.share_copied)});$(".field-social>.copy-button").click(function(){Clipboard.copy($(".field-social>textarea").val());alert(rl_js_params.trans.share_copied)});$(".woocommerce-product-gallery__image img").elevateZoom({scrollZoom:true,loadingIcon:"/rl/static/images/orange-loading.gif"});$("[data-fancybox]").fancybox({loop:true,button:["slideshow","fullScreen","thumbs","close"]});$("#rl_shipping_type").change(function(){var add_to_cart=$("button.single_add_to_cart_button");var productId=add_to_cart.val()===""?$("input.variation_id").val():add_to_cart.val();if(productId!=""){var feeEle=$(".shipping-fee");var qty=$("input.qty").val();feeEle.html('<i class="fa fa-circle-o-notch fa-spin"></i> &nbsp;'+feeEle.attr("loading-text"));var url=rl_js_params.api_url+"/products/fee/"+productId;var data={shippingType:$(this).val(),quantity:isNaN(qty)?1:qty,province:$("select.province-select").val()};getJson(data,url).then(function(res){if(res.status==="ok"){feeEle.html("￥"+res.result.fee)}else{feeEle.text(rl_js_params.trans.error_refresh_message)}})}});$("select.province-select").change(function(){var add_to_cart=$("button.single_add_to_cart_button");var productId=add_to_cart.val()===""?$("input.variation_id").val():add_to_cart.val();if(productId!=""){var feeEle=$(".shipping-fee");var qty=$("input.qty").val();var shippingType=$("#rl_shipping_type").val();feeEle.html('<i class="fa fa-circle-o-notch fa-spin"></i> &nbsp;'+feeEle.attr("loading-text"));var url=rl_js_params.api_url+"/products/fee/"+productId;var data={shippingType:shippingType,quantity:isNaN(qty)?1:qty,province:$(this).val()};getJson(data,url).then(function(res){if(res.status==="ok"){feeEle.html("￥"+res.result.fee)}else{feeEle.text(rl_js_params.trans.error_refresh_message)}})}});$("table.variations select").change(function(){var productId=$("input.variation_id").val();if(productId!==""){var feeEle=$(".shipping-fee");var qty=$("input.qty").val();var shippingType=$("#rl_shipping_type").val();feeEle.html('<i class="fa fa-circle-o-notch fa-spin"></i> &nbsp;'+feeEle.attr("loading-text"));var url=rl_js_params.api_url+"/products/fee/"+productId;var data={quantity:isNaN(qty)?1:qty,shippingType:shippingType,province:$("select.province-select").val()};getJson(data,url).then(function(res){if(res.status==="ok"){feeEle.html("￥"+res.result.fee)}else{feeEle.text(rl_js_params.trans.error_refresh_message)}})}});$("input.qty").change(function(){var add_to_cart=$("button.single_add_to_cart_button");var productId=add_to_cart.val()===""?$("input.variation_id").val():add_to_cart.val();if(productId!==""){var feeEle=$(".shipping-fee");var qty=$(this).val();var shippingType=$("#rl_shipping_type").val();var _qty=isNaN(qty)?1:qty;feeEle.html('<i class="fa fa-circle-o-notch fa-spin"></i> &nbsp;'+feeEle.attr("loading-text"));var url=rl_js_params.api_url+"/products/fee/"+productId;var data={quantity:_qty,shippingType:shippingType,province:$("select.province-select").val()};getJson(data,url).then(function(res){if(res.status==="ok"){feeEle.html("￥"+res.result.fee)}else{feeEle.text(rl_js_params.trans.error_refresh_message)}})}});$("#tab-title-reviews").click(function(){if($(".rating-contents>.rows").data("total_count")!="0"){var data={product_id:$(".single_add_to_cart_button").attr("value"),action:"product_feedback_refresh",overview:"1"};getJson(data).then(function(res){if(res.status==="ok"){buildFeedbackContents(res.result.feedbacks);buildFeedbackSeparator(res.result.page,res.result.total);$(".rating-contents>.loading-overlay").hide()}else{buildErrorFeedbackContent(res.content)}},function(error){buildErrorFeedbackContent("error")})}});$("#reviews [role=filter]").change(function(){var data=prepareFeedbackRefreshData();var overlay=$(".rating-contents>.loading-overlay");$(".rating-contents>.rows").hide();overlay.show();getJson(data).then(function(res){if(res.status==="ok"){buildFeedbackContents(res.result.feedbacks);buildFeedbackSeparator(res.result.page,res.result.total)}else{buildErrorFeedbackContent(res.content)}overlay.hide()},function(error){buildErrorFeedbackContent("error");overlay.hide()})});$(".page-separator>span.next").click(bindFeedbackRefreshAction)}var $slider=$(".bb-slider-wrapper");if($slider.length){var rtl=$slider.data("rtl")===1?true:false;$slider.slick({lazyLoad:"ondemand",dots:true,infinite:true,prevArrow:'<a class="slidePrev"></a>',nextArrow:'<a class="slideNext"></a>',speed:500,fade:true,adaptiveHeight:true,autoplay:true,autoplaySpeed:4500,rtl:rtl,cssEase:"linear"});$("#left-menu-toggle").on("click",function(){setTimeout(function(){$slider.slick("setPosition")},600);setTimeout(function(){$slider.slick("slickNext")},1800)});$(".slick-initialized").ready(function(){$(".slick-list").css("height","544px");$(".side-cover").fadeOut()})}});function generateFeedbackImagesContent(imageKey){var imageSrc=rl_js_params.on_test!=="1"?"https://img.buyimp.com/"+imageKey+"-":"http://img.temp.buyimp.com/"+imageKey+"-";return"\n        <div class='comment-image' c-src='"+(imageSrc+"usual")+"'>\n            <img width='50' height='50' src='"+(imageSrc+"usual")+"' />\n        </div>\n    "}function buildFeedbackContents(rows){var contents=jQuery(".rating-contents>.rows");contents.html("");if(rows.length&&rows.length>0){var feedbacks=rows.map(function(row){var feedbackDate=moment(row.post_date,"YYYY/MM/DD HH:mm:ss").format("ll");var imageContent=row.images.length>0?row.images.map(generateFeedbackImagesContent).join(""):"";return"\n                <div class='content'>\n                    <div class='info'>\n                        <p>"+row.username+"</p>\n                        <div class='mini-ratings'>\n                            <div class='star-bar'>\n                                <div class='blank'></div>\n                                <div class='filled' style='width:"+row.filled_perc+"%'></div>\n                            </div>\n                        </div>\n                        <p>"+feedbackDate+"</p>\n                    </div>\n                    <div class='text'>\n                        <p class='comment-title'>"+row.title+"</p>\n                        <p>\n                            <a class='helpful-btn' data-loading-text=\"<i class='fa fa-circle-o-notch fa-spin'></i>\" feedback-id="+row.feedback_id+">\n                                <i class='fa "+(row.is_enabled=="1"?"fa-thumbs-up":"fa-thumbs-o-up")+"'></i> \n                                (<span class='num'>"+row.helpful_num+"</span>)\n                            </a>\n                        </p>\n                        <p class='comment-content'>"+row.comment+"</p>\n                        <p class='comment-images'>"+imageContent+"</p>\n                    </div>\n                </div>"}).join("");contents.html(feedbacks);contents.find(".helpful-btn").click(feedbackHelpfulButtonHandler);contents.find(".comment-image").click(showFeedbackProductImage)}else{buildErrorFeedbackContent("none")}contents.show()}function showFeedbackProductImage(){var src=$(this).attr("c-src");if(typeof swal!=="undefined"){swal({imageUrl:src,imageWidth:300,imageHeight:300,animation:true,confirmButtonText:rl_js_params.return},function(error){swal("Loading Image Failed","","error")})}}function bindFeedbackRefreshAction(){var page=$(this).attr("page");var data=prepareFeedbackRefreshData(page)}function feedbackHelpfulButtonHandler(){if(rl_js_params.user_id!="0"){var btn=jQuery(this);var orgText=btn.html();btn.prop("disabled",true).html(btn.data("loading-text"));var data={action:"user_like_feedback_action",feedback_id:btn.attr("feedback-id")};getJson(data).then(function(res){if(res.status==="ok"){if(res.result.is_enabled){btn.prop("disabled",false).html("<i class=\"fa fa-thumbs-up\"></i> (<span class='num'>"+res.result.newNum+"</span>)")}else{btn.prop("disabled",false).html("<i class=\"fa fa-thumbs-o-up\"></i> (<span class='num'>"+res.result.newNum+"</span>)")}}else{btn.prop("disabled",false).html(orgText)}},function(error){btn.prop("disabled",false).html(orgText)})}else{jQuery(".registerNow").click()}}function buildErrorFeedbackContent(code){var row=jQuery(".rating-contents>.rows");switch(code){case"error":row.html("\n                <div class='no-result'>\n                    <h5>"+rl_js_params.trans.internal_error+"</h5>\n                </div>");break;case"none":default:row.html("\n                <div class='no-result'>\n                    <h5>"+rl_js_params.trans.no_matched_feedback+"</h5>\n                </div>")}row.show();jQuery(".rating-contents>.loading-overlay").hide()}function buildFeedbackSeparator(current,total){var separator=jQuery(".page-separator");separator.html("");var _total=total<=0?0:total;var content="";var currentPage=Number(current);if(currentPage>1){content+="<span class='last' page='"+(currentPage-1)+"'> < </span>"}content+="<span class='current'>"+current+"</span>";if(_total/10-current>0){content+="<span class='next' page='"+(currentPage+1)+"'> > </span>"}separator.html(content);separator.find("span.last, span.next").click(bindFeedbackRefreshAction)}function prepareFeedbackRefreshData(page){var _page=!page?page:1;var filters={};filters.stars=jQuery("#rating-stars").val();filters.duration=jQuery("#duration").val();filters.sortby=jQuery("#sortby").val();filters.withPic=jQuery("#with-picture").is(":checked")?"1":"0";var productContainer=jQuery("button[name=add-to-cart]").length===0?jQuery("input[name=product_id]"):jQuery("button[name=add-to-cart]");var data={page:_page,product_id:productContainer.attr("value"),action:"product_feedback_refresh"};Object.keys(filters).forEach(function(filter){if(filters[filter]!=="all"||filters[filter]==="1"){data[filter]=filters[filter]}});return data}function clickTargetElement(){var target=$(this).data("target");$(target).click()}function getJson(data){var setUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var withCredentials=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var url=setUrl===""?ajaxurl:setUrl;return jQuery.ajax({data:data,url:url,xhrFields:{withCredentials:withCredentials},dataType:"JSON",type:"GET"})}function postJson(data){var setUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var withCredentials=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var url=setUrl===""?ajaxurl:setUrl;return jQuery.ajax({data:data,url:url,xhrFields:{withCredentials:withCredentials},dataType:"JSON",type:"POST"})}function deleteJson(data){var setUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var withCredentials=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var url=setUrl===""?ajaxurl:setUrl;return jQuery.ajax({data:data,url:url,xhrFields:{withCredentials:withCredentials},dataType:"JSON",type:"DELETE"})}function putJson(data){var setUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var withCredentials=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var url=setUrl===""?ajaxurl:setUrl;return jQuery.ajax({data:data,url:url,xhrFields:{withCredentials:withCredentials},dataType:"JSON",type:"PUT"})}function postFile(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var withCredentials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var formData=new FormData;Object.keys(data).forEach(function(key){formData.append(key,data[key])});return jQuery.ajax({data:formData,type:"POST",processData:false,contentType:false,xhrFields:{withCredentials:withCredentials},url:ajaxurl})}function handle_rl_nav_category_data(productContainer){return function(res){var content="";if(res.status==="ok"&&res.result.length>0){content=res.result.map(function(product){var url=rl_js_params.can_see_details==="1"?rl_js_params.base_url+"products/"+product.ID:rl_js_params.base_url+"users";var imageUrl=product.image_key!==null?"https://img.buyimp.com/"+product.image_key+"-usual":"https://static.buyimp.com/buddyboss-marketplace/images/woo-placeholder.png";return"\n                    <li class='product' title='"+product.post_title+"'>\n                        <a href=\""+url+"\">\n                            <img width='80' height='100' src='"+imageUrl+"'/>\n                        </a>\n                    </li>\n                "}).join("")}else{content='<div class="empty"><img src="https://static.buyimp.com/no-proudct-found.png"/><p>'+rl_js_params.trans.no_product_found_for_category+"</p></div>";productContainer.next().hide()}productContainer.html("<ul class='products'>"+content+"</ul>")}}function rlDeleteActionHandler(uploaderSelector,inputSelector){return function(e){confirmToDeleteImage(function(res){$(inputSelector).val("");$("div."+uploaderSelector+">.image-container>img").attr("src","");$("div."+uploaderSelector+">.image-container>.actions>.fa-trash").addClass("hidden")})}}function rlUploaderActionHandler(uploaderSelector,inputSelector){var prefix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var size=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"usual";var after=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;return function(e){var idContainer=$(inputSelector);var imageId=idContainer.val();var action=typeof imageId==="undefined"||imageId===""||imageId=="0"?"rl_ajax_image_upload":"rl_ajax_image_replace";var uploadArgs={file:e.target.files[0],imageId:imageId,action:action,prefix:prefix};handleImageUpload.call(this,uploadArgs,function(res){var imageKey=res.image_key;var imageLink=rl_js_params.on_test==="1"?"http://img.temp.buyimp.com/"+imageKey+"-usual?"+Math.floor(Math.random()*300+1):"https://img.buyimp.com/"+imageKey+"-"+size+"?"+Math.floor(Math.random()*300+1);$("div."+uploaderSelector+">.image-container>img").attr("src",imageLink);var deleteButton=$("div."+uploaderSelector+">.image-container>.actions>.fa-trash");if(deleteButton.hasClass("hidden")){deleteButton.removeClass("hidden")}if(imageId===""||imageId=="0"){idContainer.val(res.image_id)}swal(res.message,"","success");if(after!==null){after(imageLink,imageKey)}})}}function handleImageUpload(args,onSuccess){var prefix=args.prefix||"";var parent=args.parent||0;if(args.file){var fileContainer=$(this);swal({title:rl_js_params.trans.confirm_to_use_this_picture,imageUrl:URL.createObjectURL(args.file),showLoaderOnConfirm:true,showCancelButton:true,preConfirm:function preConfirm(){return new Promise(function(resolve,reject){var data={parent:parent,prefix:prefix,action:args.action,image_id:args.imageId,image:args.file};postFile(data).then(function(res){if(res.status==="ok"){resolve(res.result)}else{reject(res.result)}},function(_rejected){reject(_rejected)})})}}).then(function(isConfirmed){if(isConfirmed&&isConfirmed.value){onSuccess(isConfirmed.value)}fileContainer.val("")},function(rejected){swal(rejected,"","error");fileContainer.val("")})}else{swal(rl_js_params.trans.invalid_image_file,"","error")}}window.Clipboard=function(window,document,navigator){var textArea,copy;function isOS(){return navigator.userAgent.match(/ipad|iphone/i)}function createTextArea(text){textArea=document.createElement("textArea");textArea.value=text;document.body.appendChild(textArea)}function selectText(){var range,selection;if(isOS()){range=document.createRange();range.selectNodeContents(textArea);selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);textArea.setSelectionRange(0,999999)}else{textArea.select()}}function copyToClipboard(){document.execCommand("copy");document.body.removeChild(textArea)}copy=function copy(text){var scrollTop=document.body.scrollTop||document.documentElement.scrollTop;createTextArea(text);selectText();document.body.scrollTop=document.documentElement.scrollTop=scrollTop;copyToClipboard()};return{copy:copy}}(window,document,navigator);function getQueryStringByName(name,url){var _url=url||window.location.href;var _name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+_name+"(=([^&#]*)|&|#|$)"),results=regex.exec(_url);if(!results)return null;if(!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "))}function recoverCartAction(){var url=rl_js_params.api_url+"/cart/recover";var button=$(this);var orgText=button.html();button.prop("disabled",true).html("<i class='fa fa-spinner fa-spin '></i>");postJson({},url).then(function(res){if(res.status==="ok"){location.reload()}else{swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.html(orgText).prop("disabled",false)}},function(rejected){swal({title:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return});button.html(orgText).prop("disabled",false)})}function commonErrorSwalHandler(){var rejected=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;swal({title:rejected?rejected:rl_js_params.trans.internal_error,customClass:"error",type:"error",confirmButtonText:rl_js_params.trans.return})}